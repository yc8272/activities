<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tobi Gerstenberg, edited by Bria Long &amp; Martin Zettersten">

<title>GGplot Tutorial: Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ggplot_inclass_step2_files/libs/clipboard/clipboard.min.js"></script>
<script src="ggplot_inclass_step2_files/libs/quarto-html/quarto.js"></script>
<script src="ggplot_inclass_step2_files/libs/quarto-html/popper.min.js"></script>
<script src="ggplot_inclass_step2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ggplot_inclass_step2_files/libs/quarto-html/anchor.min.js"></script>
<link href="ggplot_inclass_step2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ggplot_inclass_step2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ggplot_inclass_step2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ggplot_inclass_step2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ggplot_inclass_step2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#visualization-2" id="toc-visualization-2" class="nav-link active" data-scroll-target="#visualization-2">Visualization 2</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  <li><a href="#install-and-load-packages-load-data-set-theme" id="toc-install-and-load-packages-load-data-set-theme" class="nav-link" data-scroll-target="#install-and-load-packages-load-data-set-theme">Install and load packages, load data, set theme</a></li>
  <li><a href="#overview-of-different-plot-types-for-different-things" id="toc-overview-of-different-plot-types-for-different-things" class="nav-link" data-scroll-target="#overview-of-different-plot-types-for-different-things">Overview of different plot types for different things</a>
  <ul class="collapse">
  <li><a href="#proportions" id="toc-proportions" class="nav-link" data-scroll-target="#proportions">Proportions</a></li>
  <li><a href="#comparisons" id="toc-comparisons" class="nav-link" data-scroll-target="#comparisons">Comparisons</a></li>
  <li><a href="#relationships" id="toc-relationships" class="nav-link" data-scroll-target="#relationships">Relationships</a></li>
  <li><a href="#temporal-data" id="toc-temporal-data" class="nav-link" data-scroll-target="#temporal-data">Temporal data</a></li>
  </ul></li>
  <li><a href="#customizing-plots" id="toc-customizing-plots" class="nav-link" data-scroll-target="#customizing-plots">Customizing plots</a>
  <ul class="collapse">
  <li><a href="#anatomy-of-a-ggplot" id="toc-anatomy-of-a-ggplot" class="nav-link" data-scroll-target="#anatomy-of-a-ggplot">Anatomy of a <code>ggplot</code></a></li>
  <li><a href="#changing-the-order-of-things" id="toc-changing-the-order-of-things" class="nav-link" data-scroll-target="#changing-the-order-of-things">Changing the order of things</a></li>
  <li><a href="#dealing-with-legends" id="toc-dealing-with-legends" class="nav-link" data-scroll-target="#dealing-with-legends">Dealing with legends</a></li>
  <li><a href="#choosing-good-colors" id="toc-choosing-good-colors" class="nav-link" data-scroll-target="#choosing-good-colors">Choosing good colors</a></li>
  <li><a href="#customizing-themes" id="toc-customizing-themes" class="nav-link" data-scroll-target="#customizing-themes">Customizing themes</a></li>
  </ul></li>
  <li><a href="#saving-plots" id="toc-saving-plots" class="nav-link" data-scroll-target="#saving-plots">Saving plots</a></li>
  <li><a href="#creating-figure-panels" id="toc-creating-figure-panels" class="nav-link" data-scroll-target="#creating-figure-panels">Creating figure panels</a></li>
  <li><a href="#extra-fancy" id="toc-extra-fancy" class="nav-link" data-scroll-target="#extra-fancy">Extra fancy</a>
  <ul class="collapse">
  <li><a href="#peeking-behind-the-scenes" id="toc-peeking-behind-the-scenes" class="nav-link" data-scroll-target="#peeking-behind-the-scenes">Peeking behind the scenes</a></li>
  <li><a href="#making-animations" id="toc-making-animations" class="nav-link" data-scroll-target="#making-animations">Making animations</a></li>
  <li><a href="#shiny-apps" id="toc-shiny-apps" class="nav-link" data-scroll-target="#shiny-apps">Shiny apps</a></li>
  <li><a href="#defining-snippets" id="toc-defining-snippets" class="nav-link" data-scroll-target="#defining-snippets">Defining snippets</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional resources</a>
  <ul class="collapse">
  <li><a href="#cheatsheets" id="toc-cheatsheets" class="nav-link" data-scroll-target="#cheatsheets">Cheatsheets</a></li>
  <li><a href="#data-camp-courses" id="toc-data-camp-courses" class="nav-link" data-scroll-target="#data-camp-courses">Data camp courses</a></li>
  <li><a href="#books-and-chapters" id="toc-books-and-chapters" class="nav-link" data-scroll-target="#books-and-chapters">Books and chapters</a></li>
  <li><a href="#misc" id="toc-misc" class="nav-link" data-scroll-target="#misc">Misc</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">GGplot Tutorial: Part 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tobi Gerstenberg, edited by Bria Long &amp; Martin Zettersten </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="visualization-2" class="level1">
<h1>Visualization 2</h1>
<p>In this tutorial, we will lift our <code>ggplot2</code> skills to the next level!</p>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning objectives</h2>
<ul>
<li>Deciding what plot is appropriate for what kind of data.</li>
<li>Customizing plots: Take a sad plot and make it better.</li>
<li>Saving plots.</li>
<li>Making figure panels.</li>
<li>Debugging.</li>
<li>Making animations.</li>
<li>Defining snippets.</li>
</ul>
</section>
<section id="install-and-load-packages-load-data-set-theme" class="level2">
<h2 class="anchored" data-anchor-id="install-and-load-packages-load-data-set-theme">Install and load packages, load data, set theme</h2>
<p>Let’s first install the new packages that you might not have yet.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"gganimate"</span>, <span class="st">"gapminder"</span>, <span class="st">"ggridges"</span>, <span class="st">"devtools"</span>, <span class="st">"png"</span>, <span class="st">"gifski"</span>, <span class="st">"patchwork"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, let’s load the packages that we need for these exercise</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)     <span class="co"># for rendering the RMarkdown file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># for making figure panels</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)  <span class="co"># for making joyplots </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate) <span class="co"># for making animations</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder) <span class="co"># data available from Gapminder.org </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for plotting (and many more cool things we'll discover later)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And set some settings:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># these options here change the formatting of how comments are rendered</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment =</span> <span class="st">""</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">fig.show =</span> <span class="st">"hold"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># this just suppresses an unnecessary message about grouping </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> F)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set the default plotting theme </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="co">#set the theme </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))) <span class="co">#set the default text size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And let’s load the diamonds dataset we’ll use</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.diamonds <span class="ot">=</span> diamonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="overview-of-different-plot-types-for-different-things" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-different-plot-types-for-different-things">Overview of different plot types for different things</h2>
<p>Different plots work best for different kinds of data. Let’s take a look at some.</p>
<section id="proportions" class="level3">
<h3 class="anchored" data-anchor-id="proportions">Proportions</h3>
<section id="stacked-bar-charts" class="level4">
<h4 class="anchored" data-anchor-id="stacked-bar-charts">Stacked bar charts</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> color)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This bar chart shows for the different cuts (x-axis), the number of diamonds of different color. Stacked bar charts give a good general impression of the data. However, it’s difficult to precisely compare different proportions.</p>
</section>
<section id="pie-charts" class="level4">
<h4 class="anchored" data-anchor-id="pie-charts">Pie charts</h4>
<p>Pie charts have a bad reputation. And there are indeed a number of problems with pie charts:</p>
<ul>
<li>proportions are difficult to compare</li>
<li>don’t look good when there are many categories</li>
</ul>
<p>We can create a pie chart with <code>ggplot2</code> by changing the coordinate system using <code>coord_polar()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">"y"</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we are interested in comparing proportions and we don’t have too many data points, then tables are a good alternative to showing figures.</p>
</section>
</section>
<section id="comparisons" class="level3">
<h3 class="anchored" data-anchor-id="comparisons">Comparisons</h3>
<p>Often we want to compare the data from many different conditions. And sometimes, it’s also useful to get a sense for what the individual participant data look like. Here is a plot that achieves both.</p>
<section id="means-and-individual-data-points" class="level4">
<h4 class="anchored" data-anchor-id="means-and-individual-data-points">Means and individual data points</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>, ],</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># means with confidence intervals </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"pointrange"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"yellow"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># individual data points (jittered horizontally)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"blue"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="dv">0</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/diamonds-price-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Price of differently colored diamonds. Large yellow circles are means, small black circles are individual data poins, and the error bars are 95% bootstrapped confidence intervals.</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that I’m only plotting the first 150 entries of the data here by setting <code>data = df.diamonds[1:150,]</code> in <code>gpplot()</code>.</p>
<p>This plot shows means, bootstrapped confidence intervals, and individual data points. I’ve used two tricks to make the individual data points easier to see. 1. I’ve set the <code>alpha</code> attribute to make the points somewhat transparent. 2. I’ve used the <code>position_jitter()</code> function to jitter the points horizontally. 3. I’ve used <code>shape = 21</code> for displaying the mean. For this circle shape, we can set a <code>color</code> and <code>fill</code> (see <a href="#fig-plotting-shapes" class="quarto-xref">Figure&nbsp;1</a>)</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-plotting-shapes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plotting-shapes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ggplot_inclass_step2_files/figure-html/fig-plotting-shapes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotting-shapes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Different shapes that can be used for plotting.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="boxplots" class="level4">
<h4 class="anchored" data-anchor-id="boxplots">Boxplots</h4>
<p>Another way to get a sense for the distribution of the data is to use box plots.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,],</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What do boxplots show? Here adapted from <code>help(geom_boxplot())</code>:</p>
<blockquote class="blockquote">
<p>The boxplots show the median as a horizontal black line. The lower and upper hinges correspond to the first and third quartiles (the 25th and 75th percentiles) of the data. The whiskers (= black vertical lines) extend from the top or bottom of the hinge by at most 1.5 * IQR (where IQR is the inter-quartile range, or distance between the first and third quartiles). Data beyond the end of the whiskers are called “outlying” points and are plotted individually.</p>
</blockquote>
<p>Boxplots are ok, but they have limitations. Many data sets are consistent with the same boxplot.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-box-plot-distributions1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-box-plot-distributions1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/boxplots.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-box-plot-distributions1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Box plot distributions. Source: https://www.autodeskresearch.com/publications/samestats
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-box-plot-distributions1" class="quarto-xref">Figure&nbsp;2</a> shows three different distributions that each correspond to the same boxplot.</p>
<p>If there is not too much data, I recommend to plot jittered individual data points instead. If you do have a lot of data points, then violin plots can be helpful.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-box-plot-distributions2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-box-plot-distributions2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/box_violin.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-box-plot-distributions2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Boxplot distributions. Source: https://www.autodeskresearch.com/publications/samestats
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-box-plot-distributions2" class="quarto-xref">Figure&nbsp;3</a> shows the same raw data represented as jittered dots, boxplots, and violin plots.</p>
</section>
<section id="violin-plots" class="level4">
<h4 class="anchored" data-anchor-id="violin-plots">Violin plots</h4>
<p>We make violin plots like so:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Violin plots are good for detecting bimodal distributions. They work well when:</p>
<ol type="1">
<li>You have many data points.</li>
<li>The data is continuous.</li>
</ol>
<p>Violin plots don’t work well for Likert-scale data (e.g.&nbsp;ratings on a discrete scale from 1 to 7). Here is a simple example:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">rating =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.1</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">500</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">replace =</span> T))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"Likert"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> rating)) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="fl">0.1</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This represents the data ok, but it’s giving vase more than anything.</p>
<p><strong>Bonus.</strong> What is <code>set.seed()</code> doing? Why did we add it here?</p>
</section>
<section id="joy-plots" class="level4">
<h4 class="anchored" data-anchor-id="joy-plots">Joy plots</h4>
<p>We can also show the distributions along the x-axis using the <code>geom_density_ridges()</code> function from the <code>ggridges</code> package.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> price,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> color)) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  ggridges<span class="sc">::</span><span class="fu">geom_density_ridges</span>(<span class="at">scale =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 535</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practice-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="practice-plot-1">Practice plot 1</h4>
<p>Try to make the plot shown in <a href="#fig-visualization2-practice1" class="quarto-xref">Figure&nbsp;4</a>. Here is a tip:</p>
<ul>
<li>For the data argument in <code>ggplot()</code> use: <code>df.diamonds[1:10000, ]</code> (this selects the first 10000 rows).</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-visualization2-practice1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-visualization2-practice1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/vis2_practice_plot1.png" class="img-fluid figure-img" width="700">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-visualization2-practice1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Practice plot 1.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="relationships" class="level3">
<h3 class="anchored" data-anchor-id="relationships">Relationships</h3>
<section id="scatter-plots" class="level4">
<h4 class="anchored" data-anchor-id="scatter-plots">Scatter plots</h4>
<p>Scatter plots are great for looking at the relationship between two continuous variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carat,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> color)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="raster-plots" class="level4">
<h4 class="anchored" data-anchor-id="raster-plots">Raster plots</h4>
<p>These are useful for looking how a variable of interest varies as a function of two other variables. For example, when we are trying to fit a model with two parameters, we might be interested to see how well the model does for different combinations of these two parameters. Here, we’ll plot what <code>carat</code> values diamonds of different <code>color</code> and <code>clarity</code> have.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> clarity,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Not too bad. Let’s add a few tweaks to make it look nicer.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> clarity,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"carat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’ve added some outlines to the tiles by specifying <code>color = "black"</code> in <code>geom_tile()</code> and I’ve changed the scale for the fill gradient. I’ve defined the color for the low value to be “white”, and for the high value to be “black.” Finally, I’ve changed the lower and upper limit of the scale via the <code>limits</code> argument. Looks much better now! We see that diamonds with clarity <code>I1</code> and color <code>J</code> tend to have the highest <code>carat</code> values on average.</p>
</section>
</section>
<section id="temporal-data" class="level3">
<h3 class="anchored" data-anchor-id="temporal-data">Temporal data</h3>
<p>Line plots are a good choice for temporal data. Here, I’ll use the <code>txhousing</code> data that comes with the <code>ggplot2</code> package. The dataset contains information about housing sales in Texas.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.plot <span class="ot">=</span> txhousing <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Fort Worth"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Houston"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">factor</span>(city, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Houston"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Fort Worth"</span>)))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.plot,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> median,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> city,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"ribbon"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"line"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The other part is fairly straightforward. I’ve used <code>stat_summary()</code> three times: First, to define the confidence interval as a <code>geom = "ribbon"</code>. Second, to show the lines connecting the means, and third to put the means as data points points on top of the lines.</p>
<p>Let’s tweak the figure some more to make it look real good.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.plot <span class="ot">=</span> txhousing <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Fort Worth"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Houston"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">factor</span>(city, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Houston"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Fort Worth"</span>)))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>df.text <span class="ot">=</span> df.plot <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">year =</span> <span class="fu">mean</span>(year) <span class="sc">+</span> <span class="fl">0.2</span>, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">mean</span>(median))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.plot,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> median,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> city,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw dashed horizontal lines in the background</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100000</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">to =</span> <span class="dv">250000</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">by =</span> <span class="dv">50000</span>),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw ribbon</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_cl_boot,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"ribbon"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw lines connecting the means</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"line"</span>) <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw means as points</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the city names</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df.text,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> city),</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the limits for the coordinates</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1999</span>, <span class="dv">2015</span>),</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">clip =</span> <span class="st">"off"</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F) <span class="sc">+</span> </span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the x-axis labels</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2000</span>,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">to =</span> <span class="dv">2015</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the y-axis labels</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100000</span>,</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">to =</span> <span class="dv">250000</span>,</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="dv">50000</span>),</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"$"</span>,</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>,</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">to =</span> <span class="dv">250</span>,</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">by =</span> <span class="dv">50</span>),</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"K"</span>)) <span class="sc">+</span> </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set the plot title and axes titles</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Change of median house sale price in Texas"</span>,</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Median house sale price"</span>) <span class="sc">+</span> </span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"in"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="customizing-plots" class="level2">
<h2 class="anchored" data-anchor-id="customizing-plots">Customizing plots</h2>
<p>So far, we’ve seen a number of different ways of plotting data. Now, let’s look into how to customize the plots. For example, we may want to change the axis labels, add a title, increase the font size. <code>ggplot2</code> let’s you customize almost anything.</p>
<p>Let’s start simple.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot shows the average price for diamonds with a different quality of the cut, as well as the bootstrapped confidence intervals. Here are some things we can do to make it look nicer.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change color of the fill, make a little more space between bars by setting their width</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error bars thicker</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust what to show on the y-axis</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4000</span>, <span class="at">by =</span> <span class="dv">1000</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"$"</span>, <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span> </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust the range of both axes</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">5.75</span>),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F) <span class="sc">+</span> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a title, subtitle, and changed axis labels </span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price as a function of quality of cut"</span>, </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Note: The price is in US dollars"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"A"</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quality of the cut"</span>, </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span> </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adjust the text size </span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space at top of x-title </span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="fl">0.2</span>, <span class="at">unit =</span> <span class="st">"inch"</span>)), </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space t the right of y-title</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="fl">0.1</span>, <span class="at">unit =</span> <span class="st">"inch"</span>)), </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space underneath the subtitle and make it gray</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="fl">0.3</span>, <span class="at">unit =</span> <span class="st">"inch"</span>),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> <span class="st">"gray70"</span>),  </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make the plot tag bold </span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move the plot tag a little</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.tag.position =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.99</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’ve tweaked quite a few things here (and I’ve added comments to explain what’s happening). Take a quick look at the <code>theme()</code> function to see all the things you can change.</p>
<section id="anatomy-of-a-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="anatomy-of-a-ggplot">Anatomy of a <code>ggplot</code></h3>
<p>I suggest to use this general skeleton for creating a <code>ggplot</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot call with global aesthetics </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cause,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> effect)) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add geometric objects (geoms)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  ... <span class="sc">+</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add text objects </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>() <span class="sc">+</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>() <span class="sc">+</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust axes and coordinates </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>() <span class="sc">+</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>() <span class="sc">+</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>() <span class="sc">+</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define plot title, and axis titles </span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Title"</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Cause"</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Effect"</span>) <span class="sc">+</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change global aspects of the plot </span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="fl">0.5</span>, <span class="at">r =</span> <span class="fl">0.5</span>, <span class="at">unit =</span> <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># save the plot </span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"super_nice_plot.pdf"</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="changing-the-order-of-things" class="level3">
<h3 class="anchored" data-anchor-id="changing-the-order-of-things">Changing the order of things</h3>
<p>Sometimes we don’t have a natural ordering of our independent variable. In that case, it’s nice to show the data in order.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(cut, price),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>       <span class="co"># mapping = aes(x = cut, y = price)) +</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cut"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>reorder()</code> function helps us to do just that. Now, the results are ordered according to price. To show the results in descending order, I would simply need to write <code>reorder(cut, -price)</code> instead.</p>
</section>
<section id="dealing-with-legends" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-legends">Dealing with legends</h3>
<p>Legends form an important part of many figures. However, it is often better to avoid legends if possible, and directly label the data. This way, the reader doesn’t have to look back and forth between the plot and the legend to understand what’s going on.</p>
<p>Here, we’ll look into a few aspects that come up quite often. There are two main functions to manipulate legends with ggplot2 1. <code>theme()</code> (there are a number of arguments starting with <code>legend.</code>) 2. <code>guide_legend()</code></p>
<p>Let’s make a plot with a legend.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s move the legend to the bottom of the plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s change a few more things in the legend using the <code>guides()</code> function:</p>
<ul>
<li>have 3 rows</li>
<li>reverse the legend order</li>
<li>make the points in the legend larger</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">3</span>, <span class="co"># 3 rows </span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="co"># reversed order </span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>))) <span class="co"># point size </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="choosing-good-colors" class="level3">
<h3 class="anchored" data-anchor-id="choosing-good-colors">Choosing good colors</h3>
<p><a href="http://colorbrewer2.org/">Color brewer</a> helps with finding colors that are colorblind safe and printfriendly. For more information on how to use color effectively see <a href="http://socviz.co/refineplots.html#refineplots">here</a>.</p>
</section>
<section id="customizing-themes" class="level3">
<h3 class="anchored" data-anchor-id="customizing-themes">Customizing themes</h3>
<p>For a given project, I often want all of my plots to share certain visual features such as the font type, font size, how the axes are displayed, etc. Instead of defining these for each individual plot, I can set a theme at the beginning of my project so that it applies to all the plots in this file. To do so, I use the <code>theme_set()</code> command:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="co">#classic theme</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))) <span class="co">#text size </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, I’ve just defined that I want to use <code>theme_classic()</code> for all my plots, and that the text size should be 20. For any individual plot, I can still overwrite any of these defaults.</p>
</section>
</section>
<section id="saving-plots" class="level2">
<h2 class="anchored" data-anchor-id="saving-plots">Saving plots</h2>
<p>To save plots, use the <code>ggsave()</code> command. Personally, I prefer to save my plots as pdf files. This way, the plot looks good no matter what size you need it to be. This means it’ll look good both in presentations as well as in a paper. You can save the plot in any format that you like.</p>
<p>I strongly recommend to use a relative path to specify where the figure should be saved. This way, if you are sharing the project with someone else via Stanford Box, Dropbox, or Github, they will be able to run the code without errors.</p>
<p>Here is an example for how to save one of the plots that we’ve created above.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"figures/diamond_plot.pdf"</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> p1,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, I’m saving the plot in the <code>figures</code> folder and it’s name is <code>diamond_plot.pdf</code>. I also specify the width and height as the plot in inches (which is the default unit).</p>
</section>
<section id="creating-figure-panels" class="level2">
<h2 class="anchored" data-anchor-id="creating-figure-panels">Creating figure panels</h2>
<p>Sometimes, we want to create a figure with several subfigures, each of which is labeled with a), b), etc. We have already learned how to make separate panels using <code>facet_wrap()</code> or <code>facet_grid()</code>. The R package <code>patchwork</code> makes it very easy to combine multiple plots. You can find out more about the package <a href="https://patchwork.data-imaginist.com/articles/patchwork.html">here</a>.</p>
<p>Let’s combine a few plots that we’ve made above into one.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first plot</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> y,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fill =</span> color)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">bw =</span> <span class="fl">0.2</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(color)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Width of differently colored diamonds"</span>) <span class="sc">+</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F) <span class="co">#setting expand to FALSE removes any padding on x and y axes</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># second plot</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> clarity,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Carat values"</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For different color and clarity"</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Color"</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># third plot</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"fair"</span>, <span class="st">"good"</span>, <span class="st">"very</span><span class="sc">\n</span><span class="st">good"</span>, <span class="st">"premium"</span>, <span class="st">"ideal"</span>)) <span class="sc">+</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price as a function of cut"</span>, </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Note: The price is in US dollars"</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quality of the cut"</span>, </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span> </span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">5.75</span>),</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>),</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the plots</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> (p2 <span class="sc">+</span> p3) <span class="sc">+</span> </span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span> </span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">&amp;</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("figures/combined_plot.png", width = 10, height = 6)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Not a perfect plot yet, but you get the idea. To combine the plots, we defined that we would like p2 and p3 to be displayed in the same row using the <code>()</code> syntax. And we specified that we only want one column via the <code>plot_layout()</code> function. We also applied the same <code>theme_classic()</code> to all the plots using the <code>&amp;</code> operator, and formatted how the plot tags should be displayed. For more info on how to use <code>patchwork</code>, take a look at the <a href="https://github.com/thomasp85/patchwork">readme</a> on the github page.</p>
<p>Other packages that provide additional functionality for combining multiple plots into one are</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/gridExtra/index.html"><code>gridExtra</code></a> and</li>
<li><a href="https://cran.r-project.org/web/packages/cowplot/index.html"><code>cowplot</code></a>. You can find more information on how to lay out multiple plots <a href="https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html">here</a>.</li>
</ul>
<p>An alternative way for making these plots is to use Adobe Illustrator, Powerpoint, or Keynote. However, you want to make changing plots as easy as possible. Adobe Illustrator has a feature that allows you to link to files. This way, if you change the plot, the plot within the illustrator file gets updated automatically as well.</p>
<p>If possible, it’s <strong>much</strong> better to do everything in R though so that your plot can easily be reproduced by someone else.</p>
</section>
<section id="extra-fancy" class="level2">
<h2 class="anchored" data-anchor-id="extra-fancy">Extra fancy</h2>
<section id="peeking-behind-the-scenes" class="level3">
<h3 class="anchored" data-anchor-id="peeking-behind-the-scenes">Peeking behind the scenes</h3>
<p>Sometimes it can be helpful for debugging to take a look behind the scenes. Silently, <code>ggplot()</code> computes a data frame based on the information you pass to it. We can take a look at the data frame that’s underlying the plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> clarity,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>build <span class="ot">=</span> <span class="fu">ggplot_build</span>(p)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>df.plot_info <span class="ot">=</span> build<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df.plot_info) <span class="co"># data frame dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56 18</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’ve called the <code>ggplot_build()</code> function on the ggplot2 object that we saved as <code>p</code>. I’ve then printed out the data associated with that plot object. The first thing we note about the data frame is how many entries it has, 56. That’s good. This means there is one value for each of the 7 x 8 grids. The columns tell us what color was used for the <code>fill</code>, the <code>value</code> associated with each row, where each row is being displayed (<code>x</code> and <code>y</code>), etc.</p>
<p>If a plot looks weird, it’s worth taking a look behind the scenes. For example, something we thing we could have tried is the following (in fact, this is what I tried first):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> clarity,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill =</span> carat)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"black"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>build <span class="ot">=</span> <span class="fu">ggplot_build</span>(p)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>df.plot_info <span class="ot">=</span> build<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df.plot_info) <span class="co"># data frame dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53940    15</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Why does this plot look different from the one before? What went wrong here? Notice that the data frame associated with the ggplot2 object has 53940 rows. So instead of plotting means here, we plotted all the individual data points. So what we are seeing here is just the top layer of many, many layers.</p>
</section>
<section id="making-animations" class="level3">
<h3 class="anchored" data-anchor-id="making-animations">Making animations</h3>
<p>Animated plots can be a great way to illustrate your data in presentations. The R package <code>gganimate</code> lets you do just that.</p>
<p>Here is an example showing how to use it.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> gapminder,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> lifeExp,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> pop,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colour =</span> country)) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"China"</span>, <span class="st">"India"</span>)), </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> country),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.75</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> country_colors) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1,000"</span>, <span class="st">"10,000"</span>, <span class="st">"100,000"</span>)) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">23</span>)) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here come the gganimate specific bits</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Year: {frame_time}"</span>, <span class="at">x =</span> <span class="st">"GDP per capita"</span>, <span class="at">y =</span> <span class="st">"life expectancy"</span>) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(year) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"linear"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># anim_save(filename = "figures/life_gdp_animation.gif") # to save the animation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot_inclass_step2_files/figure-html/unnamed-chunk-29-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This takes a while to run but it’s worth the wait. The plot shows the relationship between GDP per capita (on the x-axis) and life expectancy (on the y-axis) changes across different years for the countries of different continents. The size of each dot represents the population size of the respective country. And different countries are shown in different colors. This animation is not super useful yet in that we don’t know which continents and countries the different dots represent. I’ve added a label to the United States, China, and India.</p>
<p>Note how little is required to define the <code>gganimate</code>-specific information! The <code>{frame_time}</code> variable changes the title for each frame. The <code>transition_time()</code> variable is set to <code>year</code>, and the kind of transition is set as ‘linear’ in <code>ease_aes()</code>. I’ve saved the animation as a gif in the figures folder. We won’t have time to go into more detail here but I encourage you to play around with <code>gganimate</code>. It’s fun, looks cool, and (if done well) makes for a great slide in your next presentation!</p>
</section>
<section id="shiny-apps" class="level3">
<h3 class="anchored" data-anchor-id="shiny-apps">Shiny apps</h3>
<p>The package <a href="https://shiny.rstudio.com/"><code>shiny</code></a> makes it relatively easy to create interactive plots that can be hosted online. Here is a <a href="https://shiny.rstudio.com/gallery/">gallery</a> with some examples.</p>
</section>
<section id="defining-snippets" class="level3">
<h3 class="anchored" data-anchor-id="defining-snippets">Defining snippets</h3>
<p>Often, we want to create similar plots over and over again. One way to achieve this is by finding the original plot, copy and pasting it, and changing the bits that need changing. Another more flexible and faster way to do this is by using snippets. Snippets are short pieces of code that</p>
<p>Here are some snippets I use:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>snippet sngg</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">$</span>{<span class="dv">1</span><span class="sc">:</span>data},</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">$</span>{<span class="dv">2</span><span class="sc">:</span>aes})) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        <span class="er">$</span>{<span class="dv">0</span>}</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>snippet sndf</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span>{<span class="dv">1</span><span class="sc">:</span>data} <span class="ot">=</span> <span class="er">$</span>{<span class="dv">1</span><span class="sc">:</span>data} <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="er">$</span>{<span class="dv">0</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To make a bar plot, I now only need to type <code>sngg</code> and then hit TAB to activate the snippet. I can then cycle through the bits in the code that are marked with <code>${Number:word}</code> by hitting TAB again.</p>
<p>In RStudio, you can change and add snippets by going to Tools –&gt; Global Options… –&gt; Code –&gt; Edit Snippets. Make sure to set the tick mark in front of Enable Code Snippets (see <a href="#fig-code-snippets" class="quarto-xref">Figure&nbsp;5</a>). ).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-code-snippets" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-code-snippets-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/snippets.png" class="img-fluid figure-img" width="591">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-code-snippets-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Enable code snippets.
</figcaption>
</figure>
</div>
</div>
</div>
<p>To edit code snippets faster, run this command from the <code>usethis</code> package. Make sure to install the package first if you don’t have it yet.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("usethis")</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_rstudio_snippets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This command opens up a separate tab in RStudio called <code>r.snippets</code> so that you can make new snippets and adapt old ones more quickly. Take a look at the snippets that RStudio already comes with. And then, make some new ones! By using snippets you will be able to avoid typing the same code over and over again, and you won’t have to memorize as much, too.</p>
</section>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional resources</h2>
<section id="cheatsheets" class="level3">
<h3 class="anchored" data-anchor-id="cheatsheets">Cheatsheets</h3>
<ul>
<li><a href="figures/shiny.pdf">shiny</a> –&gt; interactive plots</li>
</ul>
</section>
<section id="data-camp-courses" class="level3">
<h3 class="anchored" data-anchor-id="data-camp-courses">Data camp courses</h3>
<ul>
<li><a href="https://www.datacamp.com/courses/building-web-applications-in-r-with-shiny-case-studies">shiny</a></li>
</ul>
</section>
<section id="books-and-chapters" class="level3">
<h3 class="anchored" data-anchor-id="books-and-chapters">Books and chapters</h3>
<ul>
<li><a href="http://r4ds.had.co.nz/">R for Data Science book</a>
<ul>
<li><a href="http://r4ds.had.co.nz/data-visualisation.html">Data visualization</a></li>
<li><a href="http://r4ds.had.co.nz/graphics-for-communication.html">Graphics for communication</a></li>
</ul></li>
<li><a href="http://socviz.co/">Data Visualization – A practical introduction (by Kieran Healy)</a>
<ul>
<li><a href="http://socviz.co/refineplots.html#refineplots">Refine your plots</a></li>
</ul></li>
</ul>
</section>
<section id="misc" class="level3">
<h3 class="anchored" data-anchor-id="misc">Misc</h3>
<ul>
<li><a href="https://z3tt.github.io/exciting-extensions/slides.html?s=09#/layers">ggplot2 extensions</a> –&gt; gallery of ggplot2 extension packages</li>
<li><a href="https://github.com/dreamRs/esquisse">ggplot2 gui</a> –&gt; ggplot2 extension package</li>
<li><a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">ggplot2 visualizations with code</a> –&gt; gallery of plots with code</li>
<li><a href="http://colorbrewer2.org/">Color brewer</a> –&gt; for finding colors</li>
<li><a href="https://sites.psu.edu/shinyapps/">shiny apps examples</a> –&gt; shiny apps examples that focus on statistics teaching (made by students at PennState)</li>
</ul>
</section>
</section>
<section id="session-info" class="level2">
<h2 class="anchored" data-anchor-id="session-info">Session info</h2>
<p>Information about this R session including which version of R was used, and what packages were loaded.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.2 (2023-10-31)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.7.2

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    
 [5] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   
 [9] tidyverse_2.0.0 gapminder_1.0.0 gganimate_1.0.9 ggplot2_3.5.0  
[13] ggridges_0.5.6  patchwork_1.2.0 knitr_1.45     

loaded via a namespace (and not attached):
 [1] gtable_0.3.4      xfun_0.43         htmlwidgets_1.6.4 tzdb_0.4.0       
 [5] vctrs_0.6.5       tools_4.3.2       generics_0.1.3    gifski_1.12.0-2  
 [9] fansi_1.0.6       cluster_2.1.6     pkgconfig_2.0.3   data.table_1.15.4
[13] checkmate_2.3.1   lifecycle_1.0.4   compiler_4.3.2    farver_2.1.1     
[17] textshaping_0.3.7 progress_1.2.3    munsell_0.5.1     htmltools_0.5.8.1
[21] yaml_2.3.8        htmlTable_2.4.2   Formula_1.2-5     pillar_1.9.0     
[25] crayon_1.5.2      Hmisc_5.1-2       rpart_4.1.23      tidyselect_1.2.1 
[29] digest_0.6.35     stringi_1.8.3     labeling_0.4.3    fastmap_1.1.1    
[33] grid_4.3.2        colorspace_2.1-0  cli_3.6.2         magrittr_2.0.3   
[37] base64enc_0.1-3   utf8_1.2.4        foreign_0.8-86    withr_3.0.0      
[41] prettyunits_1.2.0 scales_1.3.0      backports_1.4.1   timechange_0.3.0 
[45] rmarkdown_2.26    nnet_7.3-19       gridExtra_2.3     ragg_1.3.0       
[49] png_0.1-8         hms_1.1.3         evaluate_0.23     viridisLite_0.4.2
[53] rlang_1.1.3       glue_1.7.0        tweenr_2.0.3      rstudioapi_0.16.0
[57] jsonlite_1.8.8    R6_2.5.1          systemfonts_1.0.6</code></pre>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "GGplot Tutorial: Part 2"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Tobi Gerstenberg, edited by Bria Long &amp; Martin Zettersten"</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualization 2</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>In this tutorial, we will lift our <span class="in">`ggplot2`</span> skills to the next level!</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning objectives</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Deciding what plot is appropriate for what kind of data.</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Customizing plots: Take a sad plot and make it better.</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Saving plots.</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Making figure panels.</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Debugging.</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Making animations.</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Defining snippets.</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Install and load packages, load data, set theme</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>Let's first install the new packages that you might not have yet.</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages(c("gganimate", "gapminder", "ggridges", "devtools", "png", "gifski", "patchwork"))</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>Now, let's load the packages that we need for these exercise</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)     # for rendering the RMarkdown file</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork) # for making figure panels</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggridges)  # for making joyplots </span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(gganimate) # for making animations</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(gapminder) # data available from Gapminder.org </span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) # for plotting (and many more cool things we'll discover later)</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>And set some settings:</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="co"># these options here change the formatting of how comments are rendered</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment =</span> <span class="st">""</span>,</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">fig.show =</span> <span class="st">"hold"</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="co"># this just suppresses an unnecessary message about grouping </span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> F)</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="co"># set the default plotting theme </span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="co">#set the theme </span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))) <span class="co">#set the default text size</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>And let's load the diamonds dataset we'll use</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>df.diamonds <span class="ot">=</span> diamonds</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview of different plot types for different things</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>Different plots work best for different kinds of data. Let's take a look at some.</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proportions</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Stacked bar charts</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds, </span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> color)) <span class="sc">+</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>This bar chart shows for the different cuts (x-axis), the number of diamonds of different color. Stacked bar charts give a good general impression of the data. However, it's difficult to precisely compare different proportions.</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pie charts</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>Pie charts have a bad reputation. And there are indeed a number of problems with pie charts:</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>proportions are difficult to compare</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>don't look good when there are many categories</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>We can create a pie chart with <span class="in">`ggplot2`</span> by changing the coordinate system using <span class="in">`coord_polar()`</span>.</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">"y"</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>If we are interested in comparing proportions and we don't have too many data points, then tables are a good alternative to showing figures.</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparisons</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>Often we want to compare the data from many different conditions. And sometimes, it's also useful to get a sense for what the individual participant data look like. Here is a plot that achieves both.</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Means and individual data points</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r diamonds-price, fig.cap='Price of differently colored diamonds. Large yellow circles are means, small black circles are individual data poins, and the error bars are 95% bootstrapped confidence intervals.'}</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = df.diamonds[1:150, ],</span></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = color,</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = price)) +</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a><span class="in">  # means with confidence intervals </span></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun.data = "mean_cl_boot",</span></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "pointrange",</span></span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="in">               color = "black",</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "yellow",</span></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a><span class="in">               shape = 21,</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a><span class="in">               size = 1) + </span></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a><span class="in">  # individual data points (jittered horizontally)</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.2,</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="in">             color = "blue",</span></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a><span class="in">             position = position_jitter(width = 0.1,</span></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="in">                                        height = 0),</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="in">             size = 2)</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>Note that I'm only plotting the first 150 entries of the data here by setting <span class="in">`data = df.diamonds[1:150,]`</span> in <span class="in">`gpplot()`</span>.</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>This plot shows means, bootstrapped confidence intervals, and individual data points. I've used two tricks to make the individual data points easier to see. 1. I've set the <span class="in">`alpha`</span> attribute to make the points somewhat transparent. 2. I've used the <span class="in">`position_jitter()`</span> function to jitter the points horizontally. 3. I've used <span class="in">`shape = 21`</span> for displaying the mean. For this circle shape, we can set a <span class="in">`color`</span> and <span class="in">`fill`</span> (see @fig-plotting-shapes)</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plotting-shapes, echo=FALSE, fig.cap="Different shapes that can be used for plotting."}</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-plotting-shapes</span></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a><span class="in"># plot showing the different shapes </span></span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a><span class="in">df.plot = tibble(x = rep(1:5, 5),</span></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a><span class="in">                 y = rep(seq(5, 1, -1), each = 5),</span></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a><span class="in">                 shape = 1:25) %&gt;% </span></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(shape = as.factor(shape))</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = df.plot,</span></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = x,</span></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = y,</span></span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a><span class="in">                     shape = shape)) +</span></span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(fill = "red",</span></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a><span class="in">             size = 5,</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a><span class="in">             show.legend = F) +</span></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(mapping = aes(label = shape),</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -1.3,</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 5) +</span></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_shape_manual(values = 1:25) +</span></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian(clip = "off") + </span></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()+</span></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.margin = margin(t = 0.2,</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="in">                             unit = "inch"))</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Boxplots</span></span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>Another way to get a sense for the distribution of the data is to use box plots.</span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,],</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>What do boxplots show? Here adapted from <span class="in">`help(geom_boxplot())`</span>:</span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The boxplots show the median as a horizontal black line. The lower and upper hinges correspond to the first and third quartiles (the 25th and 75th percentiles) of the data. The whiskers (= black vertical lines) extend from the top or bottom of the hinge by at most 1.5 </span><span class="sc">\*</span><span class="at"> IQR (where IQR is the inter-quartile range, or distance between the first and third quartiles). Data beyond the end of the whiskers are called "outlying" points and are plotted individually.</span></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>Boxplots are ok, but they have limitations. Many data sets are consistent with the same boxplot.</span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r box-plot-distributions1, echo=FALSE, fig.cap="Box plot distributions. Source: https://www.autodeskresearch.com/publications/samestats"}</span></span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-box-plot-distributions1</span></span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("figures/boxplots.gif")</span></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>@fig-box-plot-distributions1 shows three different distributions that each correspond to the same boxplot.</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>If there is not too much data, I recommend to plot jittered individual data points instead. If you do have a lot of data points, then violin plots can be helpful.</span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r box-plot-distributions2, echo=FALSE, fig.cap="Boxplot distributions. Source: https://www.autodeskresearch.com/publications/samestats"}</span></span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-box-plot-distributions2</span></span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("figures/box_violin.gif")</span></span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a>@fig-box-plot-distributions2 shows the same raw data represented as jittered dots, boxplots, and violin plots.</span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Violin plots</span></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>We make violin plots like so:</span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>Violin plots are good for detecting bimodal distributions. They work well when:</span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>You have many data points.</span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The data is continuous.</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>Violin plots don't work well for Likert-scale data (e.g. ratings on a discrete scale from 1 to 7). Here is a simple example:</span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">rating =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.1</span>),</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">500</span>,</span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>                              <span class="at">replace =</span> T))</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"Likert"</span>,</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> rating)) <span class="sc">+</span></span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>,</span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="fl">0.1</span>),</span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>This represents the data ok, but it's giving vase more than anything.</span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a>**Bonus.** What is <span class="in">`set.seed()`</span> doing? Why did we add it here?</span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Joy plots</span></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>We can also show the distributions along the x-axis using the <span class="in">`geom_density_ridges()`</span> function from the <span class="in">`ggridges`</span> package.</span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> price,</span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> color)) <span class="sc">+</span></span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>  ggridges<span class="sc">::</span><span class="fu">geom_density_ridges</span>(<span class="at">scale =</span> <span class="fl">1.5</span>)</span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Practice plot 1</span></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>Try to make the plot shown in @fig-visualization2-practice1. Here is a tip:</span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For the data argument in <span class="in">`ggplot()`</span> use: <span class="in">`df.diamonds[1:10000, ]`</span> (this selects the first 10000 rows).</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a><span class="co"># write your code here</span></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r visualization2-practice1, echo=FALSE, fig.cap='Practice plot 1.'}</span></span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-visualization2-practice1</span></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("figures/vis2_practice_plot1.png")</span></span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relationships</span></span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Scatter plots</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>Scatter plots are great for looking at the relationship between two continuous variables.</span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carat,</span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> color)) <span class="sc">+</span></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Raster plots</span></span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>These are useful for looking how a variable of interest varies as a function of two other variables. For example, when we are trying to fit a model with two parameters, we might be interested to see how well the model does for different combinations of these two parameters. Here, we'll plot what <span class="in">`carat`</span> values diamonds of different <span class="in">`color`</span> and <span class="in">`clarity`</span> have.</span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> clarity,</span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>)</span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>Not too bad. Let's add a few tweaks to make it look nicer.</span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> clarity,</span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>,</span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,</span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"carat"</span>)</span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a>I've added some outlines to the tiles by specifying <span class="in">`color = "black"`</span> in <span class="in">`geom_tile()`</span> and I've changed the scale for the fill gradient. I've defined the color for the low value to be "white", and for the high value to be "black." Finally, I've changed the lower and upper limit of the scale via the <span class="in">`limits`</span> argument. Looks much better now! We see that diamonds with clarity <span class="in">`I1`</span> and color <span class="in">`J`</span> tend to have the highest <span class="in">`carat`</span> values on average.</span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporal data</span></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>Line plots are a good choice for temporal data. Here, I'll use the <span class="in">`txhousing`</span> data that comes with the <span class="in">`ggplot2`</span> package. The dataset contains information about housing sales in Texas.</span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a>df.plot <span class="ot">=</span> txhousing <span class="sc">%&gt;%</span> </span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(city <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Fort Worth"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Houston"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">factor</span>(city, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Dallas"</span>, <span class="st">"Houston"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Fort Worth"</span>)))</span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.plot,</span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year,</span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> median,</span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> city,</span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"ribbon"</span>,</span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"line"</span>) <span class="sc">+</span></span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>) </span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a>The other part is fairly straightforward. I've used <span class="in">`stat_summary()`</span> three times: First, to define the confidence interval as a <span class="in">`geom = "ribbon"`</span>. Second, to show the lines connecting the means, and third to put the means as data points points on top of the lines.</span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a>Let's tweak the figure some more to make it look real good.</span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a><span class="in">df.plot = txhousing %&gt;% </span></span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(city %in% c("Dallas", "Fort Worth", "San Antonio", "Houston")) %&gt;% </span></span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(city = factor(city, levels = c("Dallas", "Houston", "San Antonio", "Fort Worth")))</span></span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a><span class="in">df.text = df.plot %&gt;% </span></span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(year == max(year)) %&gt;% </span></span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(city) %&gt;% </span></span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(year = mean(year) + 0.2, </span></span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a><span class="in">            median = mean(median))</span></span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = df.plot,</span></span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = year, </span></span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = median,</span></span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a><span class="in">                     color = city,</span></span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a><span class="in">                     fill = city)) +</span></span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a><span class="in">  # draw dashed horizontal lines in the background</span></span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = seq(from = 100000,</span></span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a><span class="in">                              to = 250000,</span></span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a><span class="in">                              by = 50000),</span></span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a><span class="in">             linetype = 2,</span></span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = 0.2) + </span></span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a><span class="in">  # draw ribbon</span></span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun.data = mean_cl_boot,</span></span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "ribbon",</span></span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a><span class="in">               alpha = 0.2,</span></span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = 0) +</span></span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a><span class="in">  # draw lines connecting the means</span></span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun = "mean", geom = "line") +</span></span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a><span class="in">  # draw means as points</span></span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun = "mean", geom = "point") +</span></span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a><span class="in">  # add the city names</span></span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = df.text,</span></span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a><span class="in">            mapping = aes(label = city),</span></span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0,</span></span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 5) + </span></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a><span class="in">  # set the limits for the coordinates</span></span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian(xlim = c(1999, 2015),</span></span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a><span class="in">                  clip = "off",</span></span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a><span class="in">                  expand = F) + </span></span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a><span class="in">  # set the x-axis labels</span></span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(breaks = seq(from = 2000,</span></span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a><span class="in">                                  to = 2015,</span></span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a><span class="in">                                  by = 5)) +</span></span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a><span class="in">  # set the y-axis labels</span></span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(breaks = seq(from = 100000,</span></span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a><span class="in">                                  to = 250000,</span></span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a><span class="in">                                  by = 50000),</span></span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = str_c("$",</span></span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a><span class="in">                                    seq(from = 100,</span></span>
<span id="cb39-402"><a href="#cb39-402" aria-hidden="true" tabindex="-1"></a><span class="in">                                        to = 250,</span></span>
<span id="cb39-403"><a href="#cb39-403" aria-hidden="true" tabindex="-1"></a><span class="in">                                        by = 50),</span></span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "K")) + </span></span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a><span class="in">  # set the plot title and axes titles</span></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Change of median house sale price in Texas",</span></span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Year",</span></span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Median house sale price") + </span></span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(title = element_text(size = 16),</span></span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "none",</span></span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.margin = margin(r = 1, unit = "in"))</span></span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a><span class="fu">## Customizing plots</span></span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a>So far, we've seen a number of different ways of plotting data. Now, let's look into how to customize the plots. For example, we may want to change the axis labels, add a title, increase the font size. <span class="in">`ggplot2`</span> let's you customize almost anything.</span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a>Let's start simple.</span>
<span id="cb39-419"><a href="#cb39-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-423"><a href="#cb39-423" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-424"><a href="#cb39-424" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut, <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>)</span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a>This plot shows the average price for diamonds with a different quality of the cut, as well as the bootstrapped confidence intervals. Here are some things we can do to make it look nicer.</span>
<span id="cb39-433"><a href="#cb39-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds, </span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a>  <span class="co"># change color of the fill, make a little more space between bars by setting their width</span></span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb39-443"><a href="#cb39-443" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb39-444"><a href="#cb39-444" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span> </span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make error bars thicker</span></span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust what to show on the y-axis</span></span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4000</span>, <span class="at">by =</span> <span class="dv">1000</span>),</span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"$"</span>, <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4000</span>, <span class="at">by =</span> <span class="dv">1000</span>))) <span class="sc">+</span> </span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjust the range of both axes</span></span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">5.75</span>),</span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>),</span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F) <span class="sc">+</span> </span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a title, subtitle, and changed axis labels </span></span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price as a function of quality of cut"</span>, </span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Note: The price is in US dollars"</span>,</span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">"A"</span>,</span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quality of the cut"</span>, </span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span> </span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adjust the text size </span></span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space at top of x-title </span></span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="fl">0.2</span>, <span class="at">unit =</span> <span class="st">"inch"</span>)), </span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space t the right of y-title</span></span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="fl">0.1</span>, <span class="at">unit =</span> <span class="st">"inch"</span>)), </span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some space underneath the subtitle and make it gray</span></span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="fl">0.3</span>, <span class="at">unit =</span> <span class="st">"inch"</span>),</span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> <span class="st">"gray70"</span>),  </span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make the plot tag bold </span></span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move the plot tag a little</span></span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.tag.position =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.99</span>)</span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a>I've tweaked quite a few things here (and I've added comments to explain what's happening). Take a quick look at the <span class="in">`theme()`</span> function to see all the things you can change.</span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a><span class="fu">### Anatomy of a `ggplot`</span></span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a>I suggest to use this general skeleton for creating a <span class="in">`ggplot`</span>:</span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F}</span></span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot call with global aesthetics </span></span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = data,</span></span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = cause,</span></span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = effect)) +</span></span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a><span class="in">  # add geometric objects (geoms)</span></span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + </span></span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun = "mean", geom = "point") + </span></span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a><span class="in">  ... + </span></span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a><span class="in">  # add text objects </span></span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text() + </span></span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate() + </span></span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a><span class="in">  # adjust axes and coordinates </span></span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous() + </span></span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous() + </span></span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian() + </span></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a><span class="in">  # define plot title, and axis titles </span></span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Title",</span></span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Cause",</span></span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Effect") + </span></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a><span class="in">  # change global aspects of the plot </span></span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(text = element_text(size = 20),</span></span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.margin = margin(t = 1, b = 1, l = 0.5, r = 0.5, unit = "cm")) +</span></span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a><span class="in"># save the plot </span></span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave(filename = "super_nice_plot.pdf",</span></span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a><span class="in">       width = 8,</span></span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a><span class="in">       height = 6)</span></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a><span class="fu">### Changing the order of things</span></span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a>Sometimes we don't have a natural ordering of our independent variable. In that case, it's nice to show the data in order.</span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-524"><a href="#cb39-524" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(cut, price),</span>
<span id="cb39-525"><a href="#cb39-525" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a>       <span class="co"># mapping = aes(x = cut, y = price)) +</span></span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cut"</span>)</span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a>The <span class="in">`reorder()`</span> function helps us to do just that. Now, the results are ordered according to price. To show the results in descending order, I would simply need to write <span class="in">`reorder(cut, -price)`</span> instead.</span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dealing with legends</span></span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a>Legends form an important part of many figures. However, it is often better to avoid legends if possible, and directly label the data. This way, the reader doesn't have to look back and forth between the plot and the legend to understand what's going on.</span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a>Here, we'll look into a few aspects that come up quite often. There are two main functions to manipulate legends with ggplot2 1. <span class="in">`theme()`</span> (there are a number of arguments starting with <span class="in">`legend.`</span>) 2. <span class="in">`guide_legend()`</span></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a>Let's make a plot with a legend.</span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>)</span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a>Let's move the legend to the bottom of the plot:</span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a>Let's change a few more things in the legend using the <span class="in">`guides()`</span> function:</span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>have 3 rows</span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>reverse the legend order</span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>make the points in the legend larger</span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-583"><a href="#cb39-583" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-584"><a href="#cb39-584" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> price,</span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">3</span>, <span class="co"># 3 rows </span></span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a>                              <span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="co"># reversed order </span></span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a>                              <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>))) <span class="co"># point size </span></span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing good colors</span></span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Color brewer</span><span class="co">](http://colorbrewer2.org/)</span> helps with finding colors that are colorblind safe and printfriendly. For more information on how to use color effectively see <span class="co">[</span><span class="ot">here</span><span class="co">](http://socviz.co/refineplots.html#refineplots)</span>.</span>
<span id="cb39-598"><a href="#cb39-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-599"><a href="#cb39-599" aria-hidden="true" tabindex="-1"></a><span class="fu">### Customizing themes</span></span>
<span id="cb39-600"><a href="#cb39-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-601"><a href="#cb39-601" aria-hidden="true" tabindex="-1"></a>For a given project, I often want all of my plots to share certain visual features such as the font type, font size, how the axes are displayed, etc. Instead of defining these for each individual plot, I can set a theme at the beginning of my project so that it applies to all the plots in this file. To do so, I use the <span class="in">`theme_set()`</span> command:</span>
<span id="cb39-602"><a href="#cb39-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-603"><a href="#cb39-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb39-604"><a href="#cb39-604" aria-hidden="true" tabindex="-1"></a><span class="in">theme_set(theme_classic() + #classic theme</span></span>
<span id="cb39-605"><a href="#cb39-605" aria-hidden="true" tabindex="-1"></a><span class="in">            theme(text = element_text(size = 20))) #text size </span></span>
<span id="cb39-606"><a href="#cb39-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-607"><a href="#cb39-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-608"><a href="#cb39-608" aria-hidden="true" tabindex="-1"></a>Here, I've just defined that I want to use <span class="in">`theme_classic()`</span> for all my plots, and that the text size should be 20. For any individual plot, I can still overwrite any of these defaults.</span>
<span id="cb39-609"><a href="#cb39-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-610"><a href="#cb39-610" aria-hidden="true" tabindex="-1"></a><span class="fu">## Saving plots</span></span>
<span id="cb39-611"><a href="#cb39-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-612"><a href="#cb39-612" aria-hidden="true" tabindex="-1"></a>To save plots, use the <span class="in">`ggsave()`</span> command. Personally, I prefer to save my plots as pdf files. This way, the plot looks good no matter what size you need it to be. This means it'll look good both in presentations as well as in a paper. You can save the plot in any format that you like.</span>
<span id="cb39-613"><a href="#cb39-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-614"><a href="#cb39-614" aria-hidden="true" tabindex="-1"></a>I strongly recommend to use a relative path to specify where the figure should be saved. This way, if you are sharing the project with someone else via Stanford Box, Dropbox, or Github, they will be able to run the code without errors.</span>
<span id="cb39-615"><a href="#cb39-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-616"><a href="#cb39-616" aria-hidden="true" tabindex="-1"></a>Here is an example for how to save one of the plots that we've created above.</span>
<span id="cb39-617"><a href="#cb39-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-618"><a href="#cb39-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results = "hold"}</span></span>
<span id="cb39-619"><a href="#cb39-619" aria-hidden="true" tabindex="-1"></a><span class="in">p1 = ggplot(data = df.diamonds,</span></span>
<span id="cb39-620"><a href="#cb39-620" aria-hidden="true" tabindex="-1"></a><span class="in">            mapping = aes(x = cut, y = price)) +</span></span>
<span id="cb39-621"><a href="#cb39-621" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun = "mean",</span></span>
<span id="cb39-622"><a href="#cb39-622" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "bar",</span></span>
<span id="cb39-623"><a href="#cb39-623" aria-hidden="true" tabindex="-1"></a><span class="in">               color = "black",</span></span>
<span id="cb39-624"><a href="#cb39-624" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "lightblue") +</span></span>
<span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun.data = "mean_cl_boot",</span></span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "linerange",</span></span>
<span id="cb39-627"><a href="#cb39-627" aria-hidden="true" tabindex="-1"></a><span class="in">               size = 1)</span></span>
<span id="cb39-628"><a href="#cb39-628" aria-hidden="true" tabindex="-1"></a><span class="in">print(p1)</span></span>
<span id="cb39-629"><a href="#cb39-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-630"><a href="#cb39-630" aria-hidden="true" tabindex="-1"></a><span class="in">p2 = ggplot(data = df.diamonds,</span></span>
<span id="cb39-631"><a href="#cb39-631" aria-hidden="true" tabindex="-1"></a><span class="in">            mapping = aes(x = cut, y = price)) +</span></span>
<span id="cb39-632"><a href="#cb39-632" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun = "mean",</span></span>
<span id="cb39-633"><a href="#cb39-633" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "bar",</span></span>
<span id="cb39-634"><a href="#cb39-634" aria-hidden="true" tabindex="-1"></a><span class="in">               color = "black",</span></span>
<span id="cb39-635"><a href="#cb39-635" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "lightblue") +</span></span>
<span id="cb39-636"><a href="#cb39-636" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_summary(fun.data = "mean_cl_boot",</span></span>
<span id="cb39-637"><a href="#cb39-637" aria-hidden="true" tabindex="-1"></a><span class="in">               geom = "linerange",</span></span>
<span id="cb39-638"><a href="#cb39-638" aria-hidden="true" tabindex="-1"></a><span class="in">               size = 1)</span></span>
<span id="cb39-639"><a href="#cb39-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-640"><a href="#cb39-640" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave(filename = "figures/diamond_plot.pdf",</span></span>
<span id="cb39-641"><a href="#cb39-641" aria-hidden="true" tabindex="-1"></a><span class="in">       plot = p1,</span></span>
<span id="cb39-642"><a href="#cb39-642" aria-hidden="true" tabindex="-1"></a><span class="in">       width = 8,</span></span>
<span id="cb39-643"><a href="#cb39-643" aria-hidden="true" tabindex="-1"></a><span class="in">       height = 6)</span></span>
<span id="cb39-644"><a href="#cb39-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-645"><a href="#cb39-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-646"><a href="#cb39-646" aria-hidden="true" tabindex="-1"></a>Here, I'm saving the plot in the <span class="in">`figures`</span> folder and it's name is <span class="in">`diamond_plot.pdf`</span>. I also specify the width and height as the plot in inches (which is the default unit).</span>
<span id="cb39-647"><a href="#cb39-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-648"><a href="#cb39-648" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating figure panels</span></span>
<span id="cb39-649"><a href="#cb39-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-650"><a href="#cb39-650" aria-hidden="true" tabindex="-1"></a>Sometimes, we want to create a figure with several subfigures, each of which is labeled with a), b), etc. We have already learned how to make separate panels using <span class="in">`facet_wrap()`</span> or <span class="in">`facet_grid()`</span>. The R package <span class="in">`patchwork`</span> makes it very easy to combine multiple plots. You can find out more about the package <span class="co">[</span><span class="ot">here</span><span class="co">](https://patchwork.data-imaginist.com/articles/patchwork.html)</span>.</span>
<span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a>Let's combine a few plots that we've made above into one.</span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a><span class="co"># first plot</span></span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> y,</span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fill =</span> color)) <span class="sc">+</span></span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">bw =</span> <span class="fl">0.2</span>,</span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a>               <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(color)) <span class="sc">+</span></span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Width of differently colored diamonds"</span>) <span class="sc">+</span> </span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F) <span class="co">#setting expand to FALSE removes any padding on x and y axes</span></span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a><span class="co"># second plot</span></span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> clarity,</span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a>                          <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>) <span class="sc">+</span></span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Carat values"</span>,</span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"For different color and clarity"</span>,</span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Color"</span>)</span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a><span class="co"># third plot</span></span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-681"><a href="#cb39-681" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cut,</span>
<span id="cb39-682"><a href="#cb39-682" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> price)) <span class="sc">+</span></span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>,</span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"linerange"</span>,</span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"fair"</span>, <span class="st">"good"</span>, <span class="st">"very</span><span class="sc">\n</span><span class="st">good"</span>, <span class="st">"premium"</span>, <span class="st">"ideal"</span>)) <span class="sc">+</span></span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Price as a function of cut"</span>, </span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Note: The price is in US dollars"</span>,</span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quality of the cut"</span>, </span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Price"</span>) <span class="sc">+</span> </span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">5.75</span>),</span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>),</span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> F)</span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the plots</span></span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> (p2 <span class="sc">+</span> p3) <span class="sc">+</span> </span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb39-703"><a href="#cb39-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span> </span>
<span id="cb39-704"><a href="#cb39-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">&amp;</span></span>
<span id="cb39-705"><a href="#cb39-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb39-706"><a href="#cb39-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-707"><a href="#cb39-707" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("figures/combined_plot.png", width = 10, height = 6)</span></span>
<span id="cb39-708"><a href="#cb39-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-709"><a href="#cb39-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-710"><a href="#cb39-710" aria-hidden="true" tabindex="-1"></a>Not a perfect plot yet, but you get the idea. To combine the plots, we defined that we would like p2 and p3 to be displayed in the same row using the <span class="in">`()`</span> syntax. And we specified that we only want one column via the <span class="in">`plot_layout()`</span> function. We also applied the same <span class="in">`theme_classic()`</span> to all the plots using the <span class="in">`&amp;`</span> operator, and formatted how the plot tags should be displayed. For more info on how to use <span class="in">`patchwork`</span>, take a look at the <span class="co">[</span><span class="ot">readme</span><span class="co">](https://github.com/thomasp85/patchwork)</span> on the github page.</span>
<span id="cb39-711"><a href="#cb39-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-712"><a href="#cb39-712" aria-hidden="true" tabindex="-1"></a>Other packages that provide additional functionality for combining multiple plots into one are</span>
<span id="cb39-713"><a href="#cb39-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-714"><a href="#cb39-714" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">`gridExtra`</span><span class="co">](https://cran.r-project.org/web/packages/gridExtra/index.html)</span> and</span>
<span id="cb39-715"><a href="#cb39-715" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">`cowplot`</span><span class="co">](https://cran.r-project.org/web/packages/cowplot/index.html)</span>. You can find more information on how to lay out multiple plots <span class="co">[</span><span class="ot">here</span><span class="co">](https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html)</span>.</span>
<span id="cb39-716"><a href="#cb39-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-717"><a href="#cb39-717" aria-hidden="true" tabindex="-1"></a>An alternative way for making these plots is to use Adobe Illustrator, Powerpoint, or Keynote. However, you want to make changing plots as easy as possible. Adobe Illustrator has a feature that allows you to link to files. This way, if you change the plot, the plot within the illustrator file gets updated automatically as well.</span>
<span id="cb39-718"><a href="#cb39-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-719"><a href="#cb39-719" aria-hidden="true" tabindex="-1"></a>If possible, it's **much** better to do everything in R though so that your plot can easily be reproduced by someone else.</span>
<span id="cb39-720"><a href="#cb39-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-721"><a href="#cb39-721" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extra fancy</span></span>
<span id="cb39-722"><a href="#cb39-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-723"><a href="#cb39-723" aria-hidden="true" tabindex="-1"></a><span class="fu">### Peeking behind the scenes</span></span>
<span id="cb39-724"><a href="#cb39-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-725"><a href="#cb39-725" aria-hidden="true" tabindex="-1"></a>Sometimes it can be helpful for debugging to take a look behind the scenes. Silently, <span class="in">`ggplot()`</span> computes a data frame based on the information you pass to it. We can take a look at the data frame that's underlying the plot.</span>
<span id="cb39-726"><a href="#cb39-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-729"><a href="#cb39-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-730"><a href="#cb39-730" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-731"><a href="#cb39-731" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-732"><a href="#cb39-732" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> clarity,</span>
<span id="cb39-733"><a href="#cb39-733" aria-hidden="true" tabindex="-1"></a>                         <span class="at">z =</span> carat)) <span class="sc">+</span></span>
<span id="cb39-734"><a href="#cb39-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_2d</span>(<span class="at">fun =</span> <span class="st">"mean"</span>,</span>
<span id="cb39-735"><a href="#cb39-735" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"tile"</span>,</span>
<span id="cb39-736"><a href="#cb39-736" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-737"><a href="#cb39-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>)</span>
<span id="cb39-738"><a href="#cb39-738" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-739"><a href="#cb39-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-740"><a href="#cb39-740" aria-hidden="true" tabindex="-1"></a>build <span class="ot">=</span> <span class="fu">ggplot_build</span>(p)</span>
<span id="cb39-741"><a href="#cb39-741" aria-hidden="true" tabindex="-1"></a>df.plot_info <span class="ot">=</span> build<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb39-742"><a href="#cb39-742" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df.plot_info) <span class="co"># data frame dimensions</span></span>
<span id="cb39-743"><a href="#cb39-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-744"><a href="#cb39-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-745"><a href="#cb39-745" aria-hidden="true" tabindex="-1"></a>I've called the <span class="in">`ggplot_build()`</span> function on the ggplot2 object that we saved as <span class="in">`p`</span>. I've then printed out the data associated with that plot object. The first thing we note about the data frame is how many entries it has, <span class="in">`r nrow(df.plot_info)`</span>. That's good. This means there is one value for each of the 7 x 8 grids. The columns tell us what color was used for the <span class="in">`fill`</span>, the <span class="in">`value`</span> associated with each row, where each row is being displayed (<span class="in">`x`</span> and <span class="in">`y`</span>), etc.</span>
<span id="cb39-746"><a href="#cb39-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-747"><a href="#cb39-747" aria-hidden="true" tabindex="-1"></a>If a plot looks weird, it's worth taking a look behind the scenes. For example, something we thing we could have tried is the following (in fact, this is what I tried first):</span>
<span id="cb39-748"><a href="#cb39-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-751"><a href="#cb39-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-752"><a href="#cb39-752" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df.diamonds,</span>
<span id="cb39-753"><a href="#cb39-753" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> color,</span>
<span id="cb39-754"><a href="#cb39-754" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> clarity,</span>
<span id="cb39-755"><a href="#cb39-755" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill =</span> carat)) <span class="sc">+</span></span>
<span id="cb39-756"><a href="#cb39-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb39-757"><a href="#cb39-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,</span>
<span id="cb39-758"><a href="#cb39-758" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"black"</span>)</span>
<span id="cb39-759"><a href="#cb39-759" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb39-760"><a href="#cb39-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-761"><a href="#cb39-761" aria-hidden="true" tabindex="-1"></a>build <span class="ot">=</span> <span class="fu">ggplot_build</span>(p)</span>
<span id="cb39-762"><a href="#cb39-762" aria-hidden="true" tabindex="-1"></a>df.plot_info <span class="ot">=</span> build<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb39-763"><a href="#cb39-763" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df.plot_info) <span class="co"># data frame dimensions</span></span>
<span id="cb39-764"><a href="#cb39-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-765"><a href="#cb39-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-766"><a href="#cb39-766" aria-hidden="true" tabindex="-1"></a>Why does this plot look different from the one before? What went wrong here? Notice that the data frame associated with the ggplot2 object has <span class="in">`r nrow(df.plot_info)`</span> rows. So instead of plotting means here, we plotted all the individual data points. So what we are seeing here is just the top layer of many, many layers.</span>
<span id="cb39-767"><a href="#cb39-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-768"><a href="#cb39-768" aria-hidden="true" tabindex="-1"></a><span class="fu">### Making animations</span></span>
<span id="cb39-769"><a href="#cb39-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-770"><a href="#cb39-770" aria-hidden="true" tabindex="-1"></a>Animated plots can be a great way to illustrate your data in presentations. The R package <span class="in">`gganimate`</span> lets you do just that.</span>
<span id="cb39-771"><a href="#cb39-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-772"><a href="#cb39-772" aria-hidden="true" tabindex="-1"></a>Here is an example showing how to use it.</span>
<span id="cb39-773"><a href="#cb39-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-774"><a href="#cb39-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, interval=1/60}</span></span>
<span id="cb39-775"><a href="#cb39-775" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = gapminder,</span></span>
<span id="cb39-776"><a href="#cb39-776" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = gdpPercap,</span></span>
<span id="cb39-777"><a href="#cb39-777" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = lifeExp,</span></span>
<span id="cb39-778"><a href="#cb39-778" aria-hidden="true" tabindex="-1"></a><span class="in">                     size = pop,</span></span>
<span id="cb39-779"><a href="#cb39-779" aria-hidden="true" tabindex="-1"></a><span class="in">                     colour = country)) +</span></span>
<span id="cb39-780"><a href="#cb39-780" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.7, show.legend = FALSE) +</span></span>
<span id="cb39-781"><a href="#cb39-781" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = gapminder %&gt;% </span></span>
<span id="cb39-782"><a href="#cb39-782" aria-hidden="true" tabindex="-1"></a><span class="in">              filter(country %in% c("United States", "China", "India")), </span></span>
<span id="cb39-783"><a href="#cb39-783" aria-hidden="true" tabindex="-1"></a><span class="in">            mapping = aes(label = country),</span></span>
<span id="cb39-784"><a href="#cb39-784" aria-hidden="true" tabindex="-1"></a><span class="in">            color = "black",</span></span>
<span id="cb39-785"><a href="#cb39-785" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -0.75,</span></span>
<span id="cb39-786"><a href="#cb39-786" aria-hidden="true" tabindex="-1"></a><span class="in">            show.legend = FALSE) +</span></span>
<span id="cb39-787"><a href="#cb39-787" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(values = country_colors) +</span></span>
<span id="cb39-788"><a href="#cb39-788" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_size(range = c(2, 12)) +</span></span>
<span id="cb39-789"><a href="#cb39-789" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_log10(breaks = c(1e3, 1e4, 1e5),</span></span>
<span id="cb39-790"><a href="#cb39-790" aria-hidden="true" tabindex="-1"></a><span class="in">                labels = c("1,000", "10,000", "100,000")) +</span></span>
<span id="cb39-791"><a href="#cb39-791" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb39-792"><a href="#cb39-792" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(text = element_text(size = 23)) +</span></span>
<span id="cb39-793"><a href="#cb39-793" aria-hidden="true" tabindex="-1"></a><span class="in">  # Here come the gganimate specific bits</span></span>
<span id="cb39-794"><a href="#cb39-794" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Year: {frame_time}", x = "GDP per capita", y = "life expectancy") +</span></span>
<span id="cb39-795"><a href="#cb39-795" aria-hidden="true" tabindex="-1"></a><span class="in">  transition_time(year) +</span></span>
<span id="cb39-796"><a href="#cb39-796" aria-hidden="true" tabindex="-1"></a><span class="in">  ease_aes("linear")</span></span>
<span id="cb39-797"><a href="#cb39-797" aria-hidden="true" tabindex="-1"></a><span class="in"># anim_save(filename = "figures/life_gdp_animation.gif") # to save the animation</span></span>
<span id="cb39-798"><a href="#cb39-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-799"><a href="#cb39-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-800"><a href="#cb39-800" aria-hidden="true" tabindex="-1"></a>This takes a while to run but it's worth the wait. The plot shows the relationship between GDP per capita (on the x-axis) and life expectancy (on the y-axis) changes across different years for the countries of different continents. The size of each dot represents the population size of the respective country. And different countries are shown in different colors. This animation is not super useful yet in that we don't know which continents and countries the different dots represent. I've added a label to the United States, China, and India.</span>
<span id="cb39-801"><a href="#cb39-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-802"><a href="#cb39-802" aria-hidden="true" tabindex="-1"></a>Note how little is required to define the <span class="in">`gganimate`</span>-specific information! The <span class="in">`{frame_time}`</span> variable changes the title for each frame. The <span class="in">`transition_time()`</span> variable is set to <span class="in">`year`</span>, and the kind of transition is set as 'linear' in <span class="in">`ease_aes()`</span>. I've saved the animation as a gif in the figures folder. We won't have time to go into more detail here but I encourage you to play around with <span class="in">`gganimate`</span>. It's fun, looks cool, and (if done well) makes for a great slide in your next presentation!</span>
<span id="cb39-803"><a href="#cb39-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-804"><a href="#cb39-804" aria-hidden="true" tabindex="-1"></a><span class="fu">### Shiny apps</span></span>
<span id="cb39-805"><a href="#cb39-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-806"><a href="#cb39-806" aria-hidden="true" tabindex="-1"></a>The package <span class="co">[</span><span class="ot">`shiny`</span><span class="co">](https://shiny.rstudio.com/)</span> makes it relatively easy to create interactive plots that can be hosted online. Here is a <span class="co">[</span><span class="ot">gallery</span><span class="co">](https://shiny.rstudio.com/gallery/)</span> with some examples.</span>
<span id="cb39-807"><a href="#cb39-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-808"><a href="#cb39-808" aria-hidden="true" tabindex="-1"></a><span class="fu">### Defining snippets</span></span>
<span id="cb39-809"><a href="#cb39-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-810"><a href="#cb39-810" aria-hidden="true" tabindex="-1"></a>Often, we want to create similar plots over and over again. One way to achieve this is by finding the original plot, copy and pasting it, and changing the bits that need changing. Another more flexible and faster way to do this is by using snippets. Snippets are short pieces of code that</span>
<span id="cb39-811"><a href="#cb39-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-812"><a href="#cb39-812" aria-hidden="true" tabindex="-1"></a>Here are some snippets I use:</span>
<span id="cb39-813"><a href="#cb39-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-814"><a href="#cb39-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb39-815"><a href="#cb39-815" aria-hidden="true" tabindex="-1"></a><span class="in">snippet sngg</span></span>
<span id="cb39-816"><a href="#cb39-816" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = ${1:data},</span></span>
<span id="cb39-817"><a href="#cb39-817" aria-hidden="true" tabindex="-1"></a><span class="in">           mapping = aes(${2:aes})) +</span></span>
<span id="cb39-818"><a href="#cb39-818" aria-hidden="true" tabindex="-1"></a><span class="in">        ${0}</span></span>
<span id="cb39-819"><a href="#cb39-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-820"><a href="#cb39-820" aria-hidden="true" tabindex="-1"></a><span class="in">snippet sndf</span></span>
<span id="cb39-821"><a href="#cb39-821" aria-hidden="true" tabindex="-1"></a><span class="in">    ${1:data} = ${1:data} %&gt;% </span></span>
<span id="cb39-822"><a href="#cb39-822" aria-hidden="true" tabindex="-1"></a><span class="in">        ${0}</span></span>
<span id="cb39-823"><a href="#cb39-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-824"><a href="#cb39-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-825"><a href="#cb39-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-826"><a href="#cb39-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-827"><a href="#cb39-827" aria-hidden="true" tabindex="-1"></a>To make a bar plot, I now only need to type <span class="in">`sngg`</span> and then hit TAB to activate the snippet. I can then cycle through the bits in the code that are marked with <span class="in">`${Number:word}`</span> by hitting TAB again.</span>
<span id="cb39-828"><a href="#cb39-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-829"><a href="#cb39-829" aria-hidden="true" tabindex="-1"></a>In RStudio, you can change and add snippets by going to Tools --<span class="sc">\&gt;</span> Global Options... --<span class="sc">\&gt;</span> Code --<span class="sc">\&gt;</span> Edit Snippets. Make sure to set the tick mark in front of Enable Code Snippets (see @fig-code-snippets). ).</span>
<span id="cb39-830"><a href="#cb39-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-831"><a href="#cb39-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r code-snippets, echo=FALSE, fig.cap="Enable code snippets."}</span></span>
<span id="cb39-832"><a href="#cb39-832" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-code-snippets</span></span>
<span id="cb39-833"><a href="#cb39-833" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("figures/snippets.png")</span></span>
<span id="cb39-834"><a href="#cb39-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-835"><a href="#cb39-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-836"><a href="#cb39-836" aria-hidden="true" tabindex="-1"></a>To edit code snippets faster, run this command from the <span class="in">`usethis`</span> package. Make sure to install the package first if you don't have it yet.</span>
<span id="cb39-837"><a href="#cb39-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-838"><a href="#cb39-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb39-839"><a href="#cb39-839" aria-hidden="true" tabindex="-1"></a><span class="in"># install.packages("usethis")</span></span>
<span id="cb39-840"><a href="#cb39-840" aria-hidden="true" tabindex="-1"></a><span class="in">usethis::edit_rstudio_snippets()</span></span>
<span id="cb39-841"><a href="#cb39-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-842"><a href="#cb39-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-843"><a href="#cb39-843" aria-hidden="true" tabindex="-1"></a>This command opens up a separate tab in RStudio called <span class="in">`r.snippets`</span> so that you can make new snippets and adapt old ones more quickly. Take a look at the snippets that RStudio already comes with. And then, make some new ones! By using snippets you will be able to avoid typing the same code over and over again, and you won't have to memorize as much, too.</span>
<span id="cb39-844"><a href="#cb39-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-845"><a href="#cb39-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional resources</span></span>
<span id="cb39-846"><a href="#cb39-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-847"><a href="#cb39-847" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cheatsheets</span></span>
<span id="cb39-848"><a href="#cb39-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-849"><a href="#cb39-849" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">shiny</span><span class="co">](figures/shiny.pdf)</span> --<span class="sc">\&gt;</span> interactive plots</span>
<span id="cb39-850"><a href="#cb39-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-851"><a href="#cb39-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data camp courses</span></span>
<span id="cb39-852"><a href="#cb39-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-853"><a href="#cb39-853" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">shiny</span><span class="co">](https://www.datacamp.com/courses/building-web-applications-in-r-with-shiny-case-studies)</span></span>
<span id="cb39-854"><a href="#cb39-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-855"><a href="#cb39-855" aria-hidden="true" tabindex="-1"></a><span class="fu">### Books and chapters</span></span>
<span id="cb39-856"><a href="#cb39-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-857"><a href="#cb39-857" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">R for Data Science book</span><span class="co">](http://r4ds.had.co.nz/)</span></span>
<span id="cb39-858"><a href="#cb39-858" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Data visualization</span><span class="co">](http://r4ds.had.co.nz/data-visualisation.html)</span></span>
<span id="cb39-859"><a href="#cb39-859" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Graphics for communication</span><span class="co">](http://r4ds.had.co.nz/graphics-for-communication.html)</span></span>
<span id="cb39-860"><a href="#cb39-860" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Data Visualization -- A practical introduction (by Kieran Healy)</span><span class="co">](http://socviz.co/)</span></span>
<span id="cb39-861"><a href="#cb39-861" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Refine your plots</span><span class="co">](http://socviz.co/refineplots.html#refineplots)</span></span>
<span id="cb39-862"><a href="#cb39-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-863"><a href="#cb39-863" aria-hidden="true" tabindex="-1"></a><span class="fu">### Misc</span></span>
<span id="cb39-864"><a href="#cb39-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-865"><a href="#cb39-865" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggplot2 extensions</span><span class="co">](https://z3tt.github.io/exciting-extensions/slides.html?s=09#/layers)</span> --<span class="sc">\&gt;</span> gallery of ggplot2 extension packages</span>
<span id="cb39-866"><a href="#cb39-866" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggplot2 gui</span><span class="co">](https://github.com/dreamRs/esquisse)</span> --<span class="sc">\&gt;</span> ggplot2 extension package</span>
<span id="cb39-867"><a href="#cb39-867" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggplot2 visualizations with code</span><span class="co">](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)</span> --<span class="sc">\&gt;</span> gallery of plots with code</span>
<span id="cb39-868"><a href="#cb39-868" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Color brewer</span><span class="co">](http://colorbrewer2.org/)</span> --<span class="sc">\&gt;</span> for finding colors</span>
<span id="cb39-869"><a href="#cb39-869" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">shiny apps examples</span><span class="co">](https://sites.psu.edu/shinyapps/)</span> --<span class="sc">\&gt;</span> shiny apps examples that focus on statistics teaching (made by students at PennState)</span>
<span id="cb39-870"><a href="#cb39-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-871"><a href="#cb39-871" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session info</span></span>
<span id="cb39-872"><a href="#cb39-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-873"><a href="#cb39-873" aria-hidden="true" tabindex="-1"></a>Information about this R session including which version of R was used, and what packages were loaded.</span>
<span id="cb39-874"><a href="#cb39-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-877"><a href="#cb39-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-878"><a href="#cb39-878" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb39-879"><a href="#cb39-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>